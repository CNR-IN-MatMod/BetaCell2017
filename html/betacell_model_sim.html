
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Code for the beta-cell insulin secretion model reproducing in vitro and in vivo conditions</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2017-03-08"><meta name="DC.source" content="betacell_model_sim.m"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h1>Code for the beta-cell insulin secretion model reproducing in vitro and in vivo conditions</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">Parameters initialization</a></li><li><a href="#3"><b>IN VITRO CONDITIONS</b></a></li><li><a href="#4">- Experiment A: Glucose and calcium decoupling</a></li><li><a href="#5">- Experiment B: Hyperglycemic clamp</a></li><li><a href="#8">- Experiment C: Glucose staircase</a></li><li><a href="#9">- Potentiation</a></li><li><a href="#10"><b>IN VIVO CONDITIONS</b></a></li><li><a href="#11">- Stepped hyperglycemic clamp (Panel A)</a></li><li><a href="#12">- IVGTT (Panel B left)</a></li><li><a href="#13">- IVGTT T2D (Panel B right)</a></li><li><a href="#14">- OGTT-like (Panel C left)</a></li><li><a href="#15">- OGTT-like T2D (Panel C right)</a></li><li><a href="#16">- Ramp glucose (Panel D left)</a></li><li><a href="#17">-  Ramp glucose T2D (Panel D right)</a></li><li><a href="#18">- Glucose hyperglycaemic clamp (Panel E left)</a></li><li><a href="#19">- Glucose hyperglycaemic clamp T2D (Panel E right)</a></li><li><a href="#20">-  Loss of 1st phase secretion with fasting hyperglicemia - glucose clamp</a></li><li><a href="#21">-  Loss of 1st phase secretion with fasting hyperglicemia - OGTT-like</a></li><li><a href="#22">- Augmented AIR in insulin resistance with augmented basal secretion</a></li><li><a href="#23">- Glucose hyperglycaemic clamp calcium peak vs no calcium peak</a></li><li><a href="#24">- Dose response NGT vs T2D - parameters of glucose ramp</a></li></ul></div><pre class="codeinput">addpath(genpath(<span class="string">'model_functions'</span>))
</pre><h2>Parameters initialization<a name="2"></a></h2><p>The parameters are the result of the fit to the experimental data (see below for the list of publications).</p><p>Each dataset (related to a specific experimental condition) and the corresponding reference parameter vector are saved in a different file .mat. Some parameters were enforced to be equal across experiments and/or conditions during the fitting (see paper).</p><pre class="codeinput"><span class="comment">% par of the experiments in vitro</span>
<span class="comment">% Henquin_2002--&gt; glucose and calcium decoupling</span>
<span class="comment">% Henquin_2006--&gt; hyperglycemic clamp</span>
<span class="comment">% Jonkers_2001--&gt; stepped hyperglycemic clamp</span>

<span class="comment">% par of the experiments on vivo - normal glucose tolerant subjects</span>
<span class="comment">% Toschi_2002_NGT--&gt; stepped hyperglycemic clamp</span>
<span class="comment">% Mari_1998_NGT--&gt; IVGTT</span>
<span class="comment">% Muscelli_2006_NGT--&gt; OGTT</span>
<span class="comment">% Seghieri_2016_NGT--&gt; glucose ramp</span>
<span class="comment">% Mychaliszin_2014_NGT--&gt; hyperglycemic clamp</span>

<span class="comment">% par of the experiments on vivo - type 2 diabetes subjects</span>
<span class="comment">% Mari_1998_T2D--&gt; IVGTT</span>
<span class="comment">% Muscelli_2006_T2D--&gt; OGTT</span>
<span class="comment">% Seghieri_2016_T2D--&gt; glucose ramp</span>
<span class="comment">% Mychaliszin_2014_T2D--&gt; hyperglycemic clamp</span>

<span class="comment">% Each element of the p vector correspond to a parameter in the equations</span>
<span class="comment">% of the article:</span>
<span class="comment">% p(1)--&gt; p6 in the equation of the article</span>
<span class="comment">% p(2)--&gt; p7 in the equation of the article</span>
<span class="comment">% p(3)--&gt; p8 in the equation of the article</span>
<span class="comment">% p(4)--&gt; p9 in the equation of the article</span>
<span class="comment">% p(5)--&gt; p10 in the equation of the article</span>
<span class="comment">% p(6)--&gt; p11 in the equation of the article</span>
<span class="comment">% p(7)--&gt; Parameter not used</span>
<span class="comment">% p(8)--&gt; p5 in the equation of the article</span>
<span class="comment">% p(9)--&gt; p1 in the equation of the article</span>
<span class="comment">% p(10)--&gt; p2 in the equation of the article</span>
<span class="comment">% p(11)--&gt; p3 in the equation of the article</span>
<span class="comment">% p(12)--&gt; p4 in the equation of the article</span>
<span class="comment">% p(13)--&gt; p15 in the equation of the article</span>
<span class="comment">% p(14)--&gt; p14 in the equation of the article</span>
<span class="comment">% p(15)--&gt; p12 in the equation of the article</span>
<span class="comment">% p(16)--&gt; p13 in the equation of the article</span>
<span class="comment">% p(17)--&gt; p21 in the equation of the article</span>
<span class="comment">% p(18)--&gt; p22 in the equation of the article</span>
<span class="comment">% p(19)--&gt; p23 in the equation of the article</span>
<span class="comment">% p(20)--&gt; p24 in the equation of the article</span>
<span class="comment">% p(21)--&gt; p16 in the equation of the article</span>
<span class="comment">% p(22)--&gt; p17 in the equation of the article</span>
<span class="comment">% p(23)--&gt; p18 in the equation of the article</span>

<span class="comment">% The vector p_peak is held fixed</span>
<span class="comment">% p_peak(1)--&gt; p19 in the equation of the article</span>
<span class="comment">% p_peak(2)--&gt; p20 in the equation of the article</span>
</pre><h2><b>IN VITRO CONDITIONS</b><a name="3"></a></h2><p>In vitro data sources:</p><div><ul><li>Experiment A: Simulation of glucose and calcium decoupling. Fig. 4 J-C Henquin et al., Diabetes, 2002</li><li>Experiment B: Hyperglycemic clamp. Fig. 3 J-C Henquin et al., Diabetes, 2006.</li><li>Experiment C: Stepped hyperglycemic clamp. Fig. 7 J.C. Jonkers et al., Diabetes, 2001.</li></ul></div><h2>- Experiment A: Glucose and calcium decoupling<a name="4"></a></h2><pre class="codeinput">load <span class="string">Henquin_2002</span> <span class="comment">% load Henquin 2002 data (four data series)</span>
p=loadpar(<span class="string">'Henquin_2002'</span>); <span class="comment">% reference parameters</span>

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,ca(1),glu(1),p,ca(2),glu(2),p,ca(3),glu(3),p,ca(4),glu(4)); <span class="comment">% calculates the model output</span>

<span class="comment">% Plot  data S vs model S (Fig. 3A and S2 article)</span>

set(gcf,<span class="string">'position'</span>, [300 250 500 400])
<span class="keyword">for</span> k=1:4
    subplot(2,2,k)
    plot(sec(k).t,sec(k).v,<span class="string">'k'</span>,secmod(k).t,secmod(k).v,<span class="string">'r'</span>)
    ylabel(<span class="string">'S (pg islet^{-1} min^{-1})'</span>)
    xlabel(<span class="string">'Time (min)'</span>)
    legend(<span class="string">'Data'</span>,<span class="string">'Model'</span>)
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="betacell_model_sim_01.png" alt=""> <h2>- Experiment B: Hyperglycemic clamp<a name="5"></a></h2><pre class="codeinput">clear <span class="string">all</span> <span class="comment">%#ok&lt;*CLALL&gt;</span>

load <span class="string">Henquin_2006</span> <span class="comment">% load Henquin 2006 data (four data series)</span>
[p,p_peak]=loadpar(<span class="string">'Henquin_2006'</span>); <span class="comment">% reference parameters</span>

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,ca(1),glu(1),p,ca(2),glu(2),p,ca(3),glu(3));

<span class="comment">% Plot data glucose (Fig. 3B article)</span>
clf
set(gcf,<span class="string">'position'</span>, [250 250 500 550])
<span class="keyword">for</span> k=1:3
    subplot(3,1,k)
    plot(glu(k).t, glu(k).v,<span class="string">'k'</span>)
    ylabel(<span class="string">'G (mM)'</span>)
<span class="keyword">end</span>


<span class="comment">% Plot data calcium (Fig. 3B article)</span>
clf
<span class="keyword">for</span> k=1:3
    subplot(3,1,k)
    plot(ca(k).t, ca(k).v,<span class="string">'k'</span>)
    xlabel(<span class="string">'Time (min)'</span>)
    ylabel(<span class="string">'C (nM)'</span>)
<span class="keyword">end</span>


<span class="comment">% Plot data secretion vs model secretion (Fig. 3B article)</span>
clf
<span class="keyword">for</span> k=1:3
    subplot(3,1,k)
    plot(sec(k).t,sec(k).v,<span class="string">'k'</span>,secmod(k).t,secmod(k).v,<span class="string">'r'</span>)
    ylabel(<span class="string">'S (% of content per min)'</span>)
    xlabel(<span class="string">'Time (min)'</span>)
    legend(<span class="string">'Data'</span>,<span class="string">'Model'</span>)
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="betacell_model_sim_02.png" alt=""> <p>Plot data calcium vs model calcium (Fig. 5 article)</p><pre class="codeinput"><span class="comment">% Simulate calcium</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>
camod=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:3
    camod(k)=casim(glu(k),pca);
<span class="keyword">end</span>

clf
<span class="keyword">for</span> k=1:3
    subplot(3,1,k)
    plot(ca(k).t-0.6,ca(k).v,<span class="string">'k'</span>,camod(k).t,camod(k).v,<span class="string">'r'</span>) <span class="comment">% Time shift of 0.6 min to align calcium data with calcium simulated</span>
    ylabel(<span class="string">'C (nM)'</span>)
    xlabel(<span class="string">'Time (min)'</span>)
    legend(<span class="string">'Data'</span>,<span class="string">'Model'</span>)
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="betacell_model_sim_03.png" alt=""> <p>Plot calcium and secretion ca peak vs calcium no ca peak (Figure S9 article)</p><pre class="codeinput"><span class="comment">% Simulate calcium without intial peak</span>
pg2c=p(21:23); <span class="comment">% calcium parameter</span>
camod_nopeak=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:3
    camod_nopeak(k).v=glu2ca(pg2c,glu(k).v);
    camod_nopeak(k).t=glu(k).t;
<span class="keyword">end</span>


<span class="comment">% Simulate secretion with Ca initial peak</span>
secmod_peak=secsim(p,camod(1),glu(1),p,camod(2),glu(2),p,camod(3),glu(3));

<span class="comment">% Simulate secretion without Ca initial peak</span>
secmod_nopeak=secsim(p,camod_nopeak(1),glu(1),p,camod_nopeak(2),glu(2),p,camod_nopeak(3),glu(3));


<span class="comment">% Plot calcium</span>
clf

<span class="keyword">for</span> k=1:3
    subplot(3,1,k)
    plot(camod(k).t,camod(k).v,<span class="string">'k'</span>,camod_nopeak(k).t,camod_nopeak(k).v,<span class="string">'r'</span>)
    ylabel(<span class="string">'C (nM)'</span>)
    xlabel(<span class="string">'Time (min)'</span>)
    legend(<span class="string">'Model Ca peak'</span>,<span class="string">'Model no Ca peak'</span>)
<span class="keyword">end</span>

<span class="comment">% Plot  secretion</span>
clf


<span class="keyword">for</span> k=1:3
    subplot(3,1,k)
    plot(secmod_peak(k).t,secmod_peak(k).v,<span class="string">'k'</span>,secmod_nopeak(k).t,secmod_nopeak(k).v,<span class="string">'r'</span>)
    ylabel(<span class="string">'S (% of content per min)'</span>)
    xlabel(<span class="string">'Time (min)'</span>)
    legend(<span class="string">'Model Ca peak'</span>,<span class="string">'Model no Ca peak'</span>)
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="betacell_model_sim_04.png" alt=""> <h2>- Experiment C: Glucose staircase<a name="8"></a></h2><pre class="codeinput">clear <span class="string">all</span>

load <span class="string">Jonkers_2001</span> <span class="comment">% Data from figure 7 Jonkers et al. 2001</span>
p=loadpar(<span class="string">'Jonkers_2001'</span>); <span class="comment">% reference parameter</span>

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,ca,glu);


<span class="comment">% Plot data glucose (Fig. 3C article)</span>
clf

subplot(3,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
xlabel(<span class="string">'Time(min)'</span>)
ylabel(<span class="string">'G (mM)'</span>)

<span class="comment">% Plot data calcium (Fig. 3C article)</span>
subplot(3,1,2)
plot(ca.t,ca.v,<span class="string">'k'</span>)
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'C (nM)'</span>)

<span class="comment">% Plot data secretion vs model secretion (Fig. 3C article)</span>
subplot(3,1,3)
plot(sec.t,sec.v,<span class="string">'k'</span>,secmod.t,secmod.v,<span class="string">'r'</span>)
ylabel(<span class="string">'S (pg/min)'</span>)
xlabel(<span class="string">'Time (min)'</span>)
legend(<span class="string">'Data'</span>,<span class="string">'Model'</span>)
</pre><img vspace="5" hspace="5" src="betacell_model_sim_05.png" alt=""> <h2>- Potentiation<a name="9"></a></h2><pre class="codeinput">clear <span class="string">all</span>

[p,p_peak]=loadpar(<span class="string">'Henquin_2006'</span>); <span class="comment">% reference parameters</span>

<span class="comment">% set glucose</span>
glu.t=0:110;
glu.v=[8.5*ones(1,10) 16.7*ones(1,61) 8.5*ones(1,10) 16.7*ones(1,30)];

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>

camod=casim(glu,pca);

<span class="comment">% Simulate secretion</span>
[secmod, irp,r]=secsim(p,camod,glu);

<span class="comment">% Plot glucose</span>

clf
set(gcf,<span class="string">'position'</span>, [250 250 500 800])
subplot(5,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
xlabel(<span class="string">'Time(min)'</span>)
ylabel(<span class="string">'G (mM)'</span>)

<span class="comment">% Plot calcium</span>
subplot(5,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>)
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'C (nM)'</span>)

<span class="comment">% Plot  secretion</span>
subplot(5,1,3)
plot(secmod.t,secmod.v,<span class="string">'k'</span>)
ylabel(<span class="string">'S (% of content per min)'</span>)
xlabel(<span class="string">'Time (min)'</span>)

<span class="comment">% Plot Immediately releasable pool</span>
subplot(5,1,4)
plot(irp.t, irp.v,<span class="string">'k'</span>)
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'Q (pmol/m^{2})'</span>)
xlabel(<span class="string">'Time (min)'</span>)


<span class="comment">% Plot refilling</span>
subplot(5,1,5)
plot(r(1).t, r(1).v,<span class="string">'k'</span>)
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'r (pmol min^{-1} m^{-2})'</span>)
xlabel(<span class="string">'Time (min)'</span>)
</pre><img vspace="5" hspace="5" src="betacell_model_sim_06.png" alt=""> <h2><b>IN VIVO CONDITIONS</b><a name="10"></a></h2><p>Calcium concentrations in vivo are not available experimentally. As described in the paper, the C(G) relationship is implemented in the `casim()` function.</p><p>In vivo data source:</p><div><ul><li>Stepped hyperglycemic clamp: Toschi et al., 2002</li><li>IVGTT: Fig 3 Mari A., Diabetologia, 1998</li><li>OGTT-like: Fig. 3 Muscelli E. et al, Am. J. Physiol. Endocrinol. Metab., 2006</li><li>Glucose ramp: Seghieri et al., Am. J. Physiol. Endocrinol. Metab., 2016</li><li>Hyperglycemic clamp: Mychaliszin et al., Diabetes, 2014</li></ul></div><h2>- Stepped hyperglycemic clamp (Panel A)<a name="11"></a></h2><p>Data from Toschi et al., 2002</p><pre class="codeinput">clear <span class="string">all</span>

<span class="comment">% load data</span>
load <span class="string">Toschi_2002_NGT</span>

[p,p_peak]=loadpar(<span class="string">'Toschi_2002_NGT'</span>); <span class="comment">% reference parameters</span>

BSA=2.1605; <span class="comment">% body surface calculated from data</span>

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>

camod=casim(glu,pca);

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,camod,glu);

<span class="comment">% Plot glucose, calcium, secretion</span>


clf
set(gcf,<span class="string">'position'</span>, [250 250 500 550])
subplot(3,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-5, 90, 4, <span class="string">''</span>, 0, 20, 5, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>)
setAxes(-5, 90, 4, <span class="string">''</span>, 0, 400, 3, <span class="string">'C (nmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,3)
plot(sec.t,sec.v/BSA,<span class="string">'k'</span>,secmod.t,secmod.v/BSA,<span class="string">'r'</span>) <span class="comment">% data and model secretion need to be normalized to body surface</span>
setAxes(-5, 90, 4, <span class="string">'Time (min)'</span>, 0, 600, 3, <span class="string">'S (pmol min^{-1}m^{-2})'</span>) <span class="comment">% generate the figure with the proper layout</span>


<span class="comment">% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg')</span>
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_07.png" alt=""> <h2>- IVGTT (Panel B left)<a name="12"></a></h2><p>Data from Mari, 1998</p><pre class="codeinput">clear <span class="string">all</span>

<span class="comment">% load data</span>
load <span class="string">Mari_1998_NGT</span>

[p,p_peak]=loadpar(<span class="string">'Mari_1998_NGT'</span>); <span class="comment">% reference parameters</span>

BSA=1.8647; <span class="comment">% body surface calculated from data</span>

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>

camod=casim(glu,pca);

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,camod,glu);

<span class="comment">% Plot glucose, calcium, secretion</span>
clf

subplot(3,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-5, 90, 4, <span class="string">''</span>, 0, 30, 4, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>)
setAxes(-5, 90, 4, <span class="string">''</span>, 0, 600, 4, <span class="string">'C (nmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,3)
plot(sec.t,sec.v,<span class="string">'k'</span>,secmod.t,secmod.v/BSA,<span class="string">'r'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-5, 90, 4, <span class="string">'Time (min)'</span>, 0, 2000, 3, <span class="string">'S (pmol min^{-1}m^{-2})'</span>) <span class="comment">% generate the figure with the proper layout</span>


<span class="comment">% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg')</span>
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_08.png" alt=""> <h2>- IVGTT T2D (Panel B right)<a name="13"></a></h2><p>Data from Mari, 1998</p><pre class="codeinput">clear <span class="string">all</span>

<span class="comment">% load data</span>
load <span class="string">Mari_1998_T2D</span>

[p,p_peak]=loadpar(<span class="string">'Mari_1998_T2D'</span>); <span class="comment">% reference parameters</span>

BSA=1.9801; <span class="comment">% body surface calculated from data</span>

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>

camod=casim(glu,pca);

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,camod,glu);

<span class="comment">% Plot glucose, calcium, secretion</span>
clf

subplot(3,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-5, 90, 4, <span class="string">''</span>, 0, 30, 4, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>)
setAxes(-5, 90, 4, <span class="string">''</span>, 0, 600, 4, <span class="string">'C (nmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,3)
plot(sec.t,sec.v,<span class="string">'k'</span>,secmod.t,secmod.v/BSA,<span class="string">'r'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-5, 90, 4, <span class="string">'Time (min)'</span>, 0, 2000, 3, <span class="string">'S (pmol min^{-1}m^{-2})'</span>) <span class="comment">% generate the figure with the proper layout</span>


<span class="comment">% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg')</span>
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_09.png" alt=""> <h2>- OGTT-like (Panel C left)<a name="14"></a></h2><p>Data from Muscelli et al., 2006</p><pre class="codeinput">clear <span class="string">all</span>

<span class="comment">% load data</span>
load <span class="string">Muscelli_2006_NGT</span>

[p,p_peak]=loadpar(<span class="string">'Muscelli_2006_NGT'</span>); <span class="comment">% reference parameters</span>

BSA=1.8956; <span class="comment">% body surface calculated from data</span>

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>

camod=casim(glu,pca);

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,camod,glu);

<span class="comment">% Plot glucose, calcium, secretion</span>
clf

subplot(3,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-5, 180, 7, <span class="string">''</span>, 5, 15, 3, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>)
setAxes(-5, 180, 7, <span class="string">''</span>, 50, 250, 3, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,3)
plot(sec.t,sec.v,<span class="string">'k'</span>,secmod.t,secmod.v/BSA,<span class="string">'r'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-5, 180, 7, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 500, 3, <span class="string">'S (pmol min^{-1}m^{-2})'</span>) <span class="comment">% generate the figure with the proper layout</span>


<span class="comment">% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg')</span>
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_10.png" alt=""> <h2>- OGTT-like T2D (Panel C right)<a name="15"></a></h2><p>Data from Muscelli et al., 2006</p><pre class="codeinput">clear <span class="string">all</span>

<span class="comment">% load data</span>
load <span class="string">Muscelli_2006_T2D</span>

[p,p_peak]=loadpar(<span class="string">'Muscelli_2006_T2D'</span>); <span class="comment">% reference parameters</span>

BSA=2.265; <span class="comment">% body surface calculated from data</span>

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>

camod=casim(glu,pca);

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,camod,glu);

<span class="comment">% Plot glucose, calcium, secretion</span>
clf

subplot(3,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-5, 180, 7, <span class="string">''</span>, 5, 15, 3, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>)
setAxes(-5, 180, 7, <span class="string">''</span>, 50, 250, 3, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,3)
plot(sec.t,sec.v,<span class="string">'k'</span>,secmod.t,secmod.v/BSA,<span class="string">'r'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-5, 180, 7, <span class="string">'Time (min)'</span>, <span class="keyword">...</span>
    0, 500, 3, <span class="string">'S (pmol min^{-1}m^{-2})'</span>) <span class="comment">% generate the figure with the proper layout</span>


<span class="comment">% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg')</span>
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_11.png" alt=""> <h2>- Ramp glucose (Panel D left)<a name="16"></a></h2><p>Data from Seghieri et al., 2016</p><pre class="codeinput">clear <span class="string">all</span>

<span class="comment">% load data</span>
load <span class="string">Seghieri_2016_NGT</span>

[p,p_peak]=loadpar(<span class="string">'Seghieri_2016_NGT'</span>); <span class="comment">% reference parameters</span>

BSA=1.9658; <span class="comment">% body surface calculated from data</span>

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>

camod=casim(glu,pca);

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,camod,glu);

<span class="comment">% Plot glucose, calcium, secretion</span>
clf

subplot(3,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-5, 180, 7, <span class="string">''</span>, 0, 30, 4, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>)
setAxes(-5, 180, 7, <span class="string">''</span>, 0, 300, 4, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,3)
plot(sec.t,sec.v,<span class="string">'k'</span>,secmod.t,secmod.v/BSA,<span class="string">'r'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-5, 180, 7, <span class="string">'Time (min)'</span>, 0, 1500, 4, <span class="string">'S (pmol min^{-1}m^{-2})'</span>) <span class="comment">% generate the figure with the proper layout</span>


<span class="comment">% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg')</span>
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_12.png" alt=""> <h2>-  Ramp glucose T2D (Panel D right)<a name="17"></a></h2><p>Data from Seghieri et al., 2016</p><pre class="codeinput">clear <span class="string">all</span>

<span class="comment">% load data</span>
load <span class="string">Seghieri_2016_T2D</span>

[p,p_peak]=loadpar(<span class="string">'Seghieri_2016_T2D'</span>); <span class="comment">% reference parameters</span>

BSA=2.0766; <span class="comment">% body surface calculated from data</span>

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>

camod=casim(glu,pca);

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,camod,glu);

<span class="comment">% Plot glucose, calcium, secretion</span>
clf

subplot(3,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-5, 180, 7, <span class="string">''</span>, 0, 30, 4, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>)
setAxes(-5, 180, 7, <span class="string">''</span>, 0, 300, 4, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,3)
plot(sec.t,sec.v,<span class="string">'k'</span>,secmod.t,secmod.v/BSA,<span class="string">'r'</span>) <span class="comment">%  model secretion needs to be normalized to body surface</span>
setAxes(-5, 180, 7, <span class="string">'Time (min)'</span>, 0, 1500, 4, <span class="string">'S (pmol min^{-1}m^{-2})'</span>) <span class="comment">% generate the figure with the proper layout</span>


<span class="comment">% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg')</span>
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_13.png" alt=""> <h2>- Glucose hyperglycaemic clamp (Panel E left)<a name="18"></a></h2><p>Data from Mychaliszin et al., 2014</p><pre class="codeinput"><span class="comment">% load data</span>
load <span class="string">Mychaliszin_2014_NGT</span>

[p,p_peak]=loadpar(<span class="string">'Mychaliszin_2014_NGT'</span>); <span class="comment">% reference parameters</span>

BSA=2.1327; <span class="comment">% body surface calculated from data</span>

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>

camod=casim(glu,pca);

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,camod,glu);

<span class="comment">% Plot glucose, calcium, secretion</span>
clf

subplot(3,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-5, 120, 5, <span class="string">''</span>, 0, 15, 4, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>)
setAxes(-5, 120, 5, <span class="string">''</span>, 0, 400, 3, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,3)
plot(sec.t,sec.v/BSA,<span class="string">'k'</span>,secmod.t,secmod.v/BSA,<span class="string">'r'</span>) <span class="comment">%  data and model secretion need to be normalized to body surface</span>
setAxes(-5, 120, 5, <span class="string">'Time (min)'</span>, 0, 6000, 4, <span class="string">'S (pmol min^{-1}m^{-2})'</span>) <span class="comment">% generate the figure with the proper layout</span>


<span class="comment">% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg')</span>
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_14.png" alt=""> <h2>- Glucose hyperglycaemic clamp T2D (Panel E right)<a name="19"></a></h2><p>Data from Mychaliszin et al., 2014</p><pre class="codeinput">clear <span class="string">all</span>

<span class="comment">% load data</span>
load <span class="string">Mychaliszin_2014_T2D</span>

[p,p_peak]=loadpar(<span class="string">'Mychaliszin_2014_T2D'</span>); <span class="comment">% reference parameters</span>

BSA=2.2283; <span class="comment">% body surface calculated from data</span>

<span class="comment">% Calculate calcium from glucose</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>

camod=casim(glu,pca);

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,camod,glu);

<span class="comment">% Plot glucose, calcium, secretion</span>
clf

subplot(3,1,1)
plot(glu.t,glu.v,<span class="string">'k'</span>)
setAxes(-5, 120, 5, <span class="string">''</span>, 0, 15, 4, <span class="string">'G (mmol/L)'</span>) <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,2)
plot(camod.t,camod.v,<span class="string">'k'</span>)
setAxes(-5, 120, 5, <span class="string">''</span>, 0, 400, 3, <span class="string">'C (nmol/L)'</span>)  <span class="comment">% generate the figure with the proper layout</span>
subplot(3,1,3)
plot(sec.t,sec.v/BSA,<span class="string">'k'</span>,secmod.t,secmod.v/BSA,<span class="string">'r'</span>) <span class="comment">%  data and model secretion need to be normalized to body surface</span>
setAxes(-5, 120, 5, <span class="string">'Time (min)'</span>, 0, 6000, 4, <span class="string">'S (pmol min^{-1}m^{-2})'</span>) <span class="comment">% generate the figure with the proper layout</span>


<span class="comment">% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg')</span>
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_15.png" alt=""> <h2>-  Loss of 1st phase secretion with fasting hyperglicemia - glucose clamp<a name="20"></a></h2><pre class="codeinput">clear <span class="string">all</span>

glu(1).t=[0:1:5 5.02:0.2:6 6:0.5:50];
glu(1).v=[5.27*ones(1,6) 15*ones(1,94)]; <span class="comment">%  basal normoglycemia</span>
glu(2).t=[0:1:5 5.02:0.2:6 6:0.5:50];
glu(2).v=[7*ones(1,6) 15*ones(1,94)];  <span class="comment">% baal hyperglycemia</span>

[p,p_peak]=loadpar(<span class="string">'Toschi_2002_NGT'</span>); <span class="comment">% reference parameters</span>

BSA=2; <span class="comment">% body surface</span>

<span class="comment">% Calculate calcium</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>
camod=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    camod(k)=casim(glu(k),pca);
<span class="keyword">end</span>

<span class="comment">% Simulate secretion</span>
[secmod, irp,r]=secsim(p,camod(1),glu(1),p,camod(2),glu(2));

<span class="comment">% Plot - Fig. S4 article</span>

<span class="comment">% Plot glucose</span>
clf
set(gcf,<span class="string">'position'</span>, [250 250 500 800])

subplot(5,1,1)
plot(glu(1).t, glu(1).v,<span class="string">'k'</span>,glu(1).t, glu(1).v,<span class="string">'r'</span>)
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'G (mM)'</span>)


<span class="comment">% Plot calcium</span>
subplot(5,1,2)
plot(camod(1).t, camod(1).v,<span class="string">'k'</span>,camod(2).t, camod(2).v,<span class="string">'r'</span>)
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'C (nM)'</span>)


<span class="comment">% Plot secretion</span>
subplot(5,1,3)
plot(secmod(1).t, secmod(1).v/BSA,<span class="string">'k'</span>,secmod(2).t, secmod(2).v/BSA,<span class="string">'r'</span>) <span class="comment">% model secretion needs to be normalized for body surface</span>
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'S (pmol min^{-1} m^{-2})'</span>)
xlabel(<span class="string">'Time (min)'</span>)


<span class="comment">% Plot Immediately releasable pool</span>
subplot(5,1,4)
plot(irp(1).t, irp(1).v/BSA,<span class="string">'k'</span>,irp(2).t, irp(2).v/BSA,<span class="string">'r'</span>) <span class="comment">% model secretion needs to be normalized for body surface</span>
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'Q (pmol/m^{2})'</span>)
xlabel(<span class="string">'Time (min)'</span>)


<span class="comment">% Plot refilling</span>
subplot(5,1,5)
plot(r(1).t, r(1).v/BSA,<span class="string">'k'</span>,r(2).t, r(2).v/BSA,<span class="string">'r'</span>) <span class="comment">% model secretion needs to be normalized for body surface</span>
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'r (pmol min^{-1} m^{-2})'</span>)
xlabel(<span class="string">'Time (min)'</span>)
legend(<span class="string">'Basal normoglycemia'</span>,<span class="string">'Basal hyperglycemia'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_16.png" alt=""> <h2>-  Loss of 1st phase secretion with fasting hyperglicemia - OGTT-like<a name="21"></a></h2><pre class="codeinput">clear <span class="string">all</span>

load <span class="string">Muscelli_2006_NGT</span> <span class="comment">% load glucose data</span>
[p,p_peak]=loadpar(<span class="string">'Muscelli_2006_NGT'</span>);

<span class="comment">% glucose input</span>
glu(1).t=glu.t; <span class="comment">% normal glucose tolerant subject</span>
glu(1).v=glu.v;
glu(2).t=glu(1).t; <span class="comment">% hyperglycemic subject</span>
glu(2).v=glu(1).v+1.5;

BSA=2; <span class="comment">% body surface</span>

<span class="comment">% Calculate calcium</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>
camod=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
<span class="keyword">for</span> k=1:2
    camod(k)=casim(glu(k),pca);
<span class="keyword">end</span>

<span class="comment">% Simulate secretion</span>
[secmod, irp,r]=secsim(p,camod(1),glu(1),p,camod(2),glu(2));


<span class="comment">% Plot - Fig. S8 article</span>

<span class="comment">% Plot glucose</span>
clf

subplot(5,1,1)
plot(glu(1).t, glu(1).v,<span class="string">'k'</span>,glu(1).t, glu(1).v,<span class="string">'r'</span>)
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'G (mM)'</span>)


<span class="comment">% Plot calcium</span>
subplot(5,1,2)
plot(camod(1).t, camod(1).v,<span class="string">'k'</span>,camod(2).t, camod(2).v,<span class="string">'r'</span>)
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'C (nM)'</span>)


<span class="comment">% Plot secretion</span>
subplot(5,1,3)
plot(secmod(1).t, secmod(1).v/BSA,<span class="string">'k'</span>,secmod(2).t, secmod(2).v/BSA,<span class="string">'r'</span>) <span class="comment">% model secretion needs to be normalized for body surface</span>
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'S (pmol min^{-1} m^{-2})'</span>)
xlabel(<span class="string">'Time (min)'</span>)


<span class="comment">% Plot Immediately releasable pool</span>
subplot(5,1,4)
plot(irp(1).t, irp(1).v/BSA,<span class="string">'k'</span>,irp(2).t, irp(2).v/BSA,<span class="string">'r'</span>) <span class="comment">% model secretion needs to be normalized for body surface</span>
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'Q (pmol/m^{2})'</span>)
xlabel(<span class="string">'Time (min)'</span>)


<span class="comment">% Plot refilling</span>
subplot(5,1,5)
plot(r(1).t, r(1).v/BSA,<span class="string">'k'</span>,r(2).t, r(2).v/BSA,<span class="string">'r'</span>) <span class="comment">% model secretion needs to be normalized for body surface</span>
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'r (pmol min^{-1} m^{-2})'</span>)
xlabel(<span class="string">'Time (min)'</span>)
legend(<span class="string">'Basal normoglycemia'</span>,<span class="string">'Basal hyperglycemia'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_17.png" alt=""> <h2>- Augmented AIR in insulin resistance with augmented basal secretion<a name="22"></a></h2><pre class="codeinput">clear <span class="string">all</span>

[p,p_peak]=loadpar(<span class="string">'Toschi_2002_NGT'</span>); <span class="comment">% reference parameters</span>
p_insres=p;
p_insres(8)=2*p(8); <span class="comment">% augmented basal secretion in insulin resistance</span>

<span class="comment">% set glucose</span>
glu.t=[0:1:5 5.02:0.2:6 6:0.5:50];
glu.v=[5.27*ones(1,6) 15*ones(1,94)];

BSA=2; <span class="comment">% body surface</span>

<span class="comment">% Calculate calcium</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>
camod=casim(glu,pca);

<span class="comment">% Simulate secretion</span>
[secmod, irp,r]=secsim(p,camod,glu,p_insres,camod,glu);


<span class="comment">% Plot - Fig. S7 article</span>

<span class="comment">% Plot glucose</span>
clf

subplot(5,1,1)
plot(glu.t, glu.v,<span class="string">'k'</span>)
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'G (mM)'</span>)



<span class="comment">% Plot calcium</span>
subplot(5,1,2)
plot(camod.t, camod.v,<span class="string">'k'</span>)
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'C (nM)'</span>)


<span class="comment">% Plot secretion</span>
subplot(5,1,3)
plot(secmod(1).t, secmod(1).v/BSA,<span class="string">'k'</span>,secmod(2).t, secmod(2).v/BSA,<span class="string">'r'</span>) <span class="comment">% model secretion needs to be normalized for body surface</span>
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'S (pmol min^{-1} m^{-2})'</span>)
xlabel(<span class="string">'Time (min)'</span>)


<span class="comment">% Plot Immediately releasable pool</span>
subplot(5,1,4)
plot(irp(1).t, irp(1).v/BSA,<span class="string">'k'</span>,irp(2).t, irp(2).v/BSA,<span class="string">'r'</span>) <span class="comment">% model secretion needs to be normalized for body surface</span>
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'Q (pmol/m^{2})'</span>)
xlabel(<span class="string">'Time (min)'</span>)


<span class="comment">% Plot refilling</span>
subplot(5,1,5)
plot(r(1).t, r(1).v/BSA,<span class="string">'k'</span>,r(2).t, r(2).v/BSA,<span class="string">'r'</span>) <span class="comment">% model secretion needs to be normalized for body surface</span>
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'r (pmol min^{-1} m^{-2})'</span>)
xlabel(<span class="string">'Time (min)'</span>)
legend(<span class="string">'Insulin sensitivity'</span>,<span class="string">'Insulin resistance'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_18.png" alt=""> <h2>- Glucose hyperglycaemic clamp calcium peak vs no calcium peak<a name="23"></a></h2><pre class="codeinput">clear <span class="string">all</span>

[p,p_peak]=loadpar(<span class="string">'Toschi_2002_NGT'</span>); <span class="comment">% reference parameters</span>

<span class="comment">% set glucose</span>
glu.t=[0:1:5 5.02:0.2:6 6:0.5:50];
glu.v=[5.27*ones(1,6) 15*ones(1,94)];

BSA=2; <span class="comment">% body surface</span>

<span class="comment">% Calculate calcium with inital peak</span>
pca=[p_peak;p(17:23)]; <span class="comment">% calcium parameter</span>
camod=struct(<span class="string">'t'</span>,{},<span class="string">'v'</span>,{});
camod(1)=casim(glu,pca);

<span class="comment">% Calculate calcium without inital peak</span>
pg2c=p(21:23); <span class="comment">% calcium parameter no peak</span>
camod(2).v=glu2ca(pg2c,glu.v);
camod(2).t=glu.t;

<span class="comment">% Simulate secretion</span>
secmod=secsim(p,camod(1),glu,p,camod(2),glu);

<span class="comment">% Plot - Fig. S9 article</span>

<span class="comment">% Plot glucose</span>
clf
set(gcf,<span class="string">'position'</span>, [250 250 500 550])

subplot(3,1,1)
plot(glu.t, glu.v,<span class="string">'k'</span>)
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'G (mM)'</span>)


<span class="comment">% Plot calcium</span>
subplot(3,1,2)
plot(camod(1).t, camod(1).v,<span class="string">'k'</span>,camod(2).t, camod(2).v,<span class="string">'r'</span>)
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'C (nM)'</span>)
legend(<span class="string">'Ca model with peak'</span>,<span class="string">'Ca model without peak'</span>)


<span class="comment">% Plot secretion</span>
subplot(3,1,3)
plot(secmod(1).t, secmod(1).v/BSA,<span class="string">'k'</span>,secmod(2).t, secmod(2).v/BSA,<span class="string">'r'</span>) <span class="comment">% model secretion needs to be normalized for body surface</span>
xlabel(<span class="string">'Time (min)'</span>)
ylabel(<span class="string">'S (pmol min^{-1} m^{-2})'</span>)
xlabel(<span class="string">'Time (min)'</span>)
legend(<span class="string">'Ca model with peak'</span>,<span class="string">'Ca model without peak'</span>)
</pre><pre class="codeoutput">Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
Warning: When delay time is set to zero, the transport delay block 'betavars/delayC' is
automatically set to support direct feedthrough. This may cause an algebraic loop. A
Memory Block can be used in place of the Transport Delay to break the loop 
</pre><img vspace="5" hspace="5" src="betacell_model_sim_19.png" alt=""> <h2>- Dose response NGT vs T2D - parameters of glucose ramp<a name="24"></a></h2><pre class="codeinput">clear <span class="string">all</span>

[p_ramp,p_peak]=loadpar(<span class="string">'Seghieri_2016_NGT'</span>); <span class="comment">% reference parameters NGT</span>
p_ramp_d=loadpar(<span class="string">'Seghieri_2016_T2D'</span>); <span class="comment">% reference parameters T2D</span>

BSA=2; <span class="comment">% body surface</span>

glu=0:30;
ca=50:300;
gluref=20;
caref=200;

<span class="comment">% Plot - Figure 7 of the article</span>
clf
set(gcf,<span class="string">'position'</span>, [250 250 500 400])

subplot(2,2,1)
plot(ca,fCa(p_ramp,ca),<span class="string">'k'</span>,ca,fCa(p_ramp_d,ca),<span class="string">'r'</span>)
xlabel(<span class="string">'C (nM)'</span>)
ylabel(<span class="string">'f_k (1/min)'</span>)
legend(<span class="string">'NGT'</span>,<span class="string">'T2D'</span>)

subplot(2,2,2)
plot(ca,fCaGlu(p_ramp,ca,gluref)/BSA,<span class="string">'k'</span>,ca,fCaGlu(p_ramp_d,ca,gluref)/BSA,<span class="string">'r'</span>) <span class="comment">% /BSA to normalize for body surface</span>
xlabel(<span class="string">'C (nM)'</span>)
ylabel(<span class="string">'f_r (pmol min^{-1}m^{-2})'</span>)
xlim([0 300])
title(<span class="string">'G=20 mM'</span>)
legend(<span class="string">'NGT'</span>,<span class="string">'T2D'</span>)

subplot(2,2,3)
plot(glu,fCaGlu(p_ramp,caref,glu)/BSA,<span class="string">'k'</span>,glu,fCaGlu(p_ramp_d,caref,glu)/BSA,<span class="string">'r'</span>) <span class="comment">% /BSA to normalize for body surface</span>
xlabel(<span class="string">'G (mM)'</span>)
ylabel(<span class="string">'f_r (pmol min^{-1}m^{-2})'</span>)
xlim([0 30])
title(<span class="string">'C=200 nM'</span>)
legend(<span class="string">'NGT'</span>,<span class="string">'T2D'</span>)
</pre><img vspace="5" hspace="5" src="betacell_model_sim_20.png" alt=""> <p class="footer"><br>
      Published with MATLAB&reg; 7.11<br></p></div><!--
##### SOURCE BEGIN #####
%% Code for the beta-cell insulin secretion model reproducing in vitro and in vivo conditions
% 
%
% 
%


%% 
addpath(genpath('model_functions'))


%% Parameters initialization
%
% The parameters are the result of the fit to the
% experimental data (see below for the list of 
% publications). 
% 
% Each dataset (related to a specific experimental condition) and the corresponding 
% reference parameter vector are saved in a different file .mat.
% Some parameters were enforced to be
% equal across experiments and/or conditions during the fitting (see
% paper).

% par of the experiments in vitro
% Henquin_2002REPLACE_WITH_DASH_DASH> glucose and calcium decoupling
% Henquin_2006REPLACE_WITH_DASH_DASH> hyperglycemic clamp
% Jonkers_2001REPLACE_WITH_DASH_DASH> stepped hyperglycemic clamp

% par of the experiments on vivo - normal glucose tolerant subjects
% Toschi_2002_NGTREPLACE_WITH_DASH_DASH> stepped hyperglycemic clamp
% Mari_1998_NGTREPLACE_WITH_DASH_DASH> IVGTT
% Muscelli_2006_NGTREPLACE_WITH_DASH_DASH> OGTT
% Seghieri_2016_NGTREPLACE_WITH_DASH_DASH> glucose ramp
% Mychaliszin_2014_NGTREPLACE_WITH_DASH_DASH> hyperglycemic clamp

% par of the experiments on vivo - type 2 diabetes subjects
% Mari_1998_T2DREPLACE_WITH_DASH_DASH> IVGTT
% Muscelli_2006_T2DREPLACE_WITH_DASH_DASH> OGTT
% Seghieri_2016_T2DREPLACE_WITH_DASH_DASH> glucose ramp
% Mychaliszin_2014_T2DREPLACE_WITH_DASH_DASH> hyperglycemic clamp

% Each element of the p vector correspond to a parameter in the equations
% of the article:
% p(1)REPLACE_WITH_DASH_DASH> p6 in the equation of the article
% p(2)REPLACE_WITH_DASH_DASH> p7 in the equation of the article
% p(3)REPLACE_WITH_DASH_DASH> p8 in the equation of the article
% p(4)REPLACE_WITH_DASH_DASH> p9 in the equation of the article
% p(5)REPLACE_WITH_DASH_DASH> p10 in the equation of the article
% p(6)REPLACE_WITH_DASH_DASH> p11 in the equation of the article
% p(7)REPLACE_WITH_DASH_DASH> Parameter not used
% p(8)REPLACE_WITH_DASH_DASH> p5 in the equation of the article
% p(9)REPLACE_WITH_DASH_DASH> p1 in the equation of the article
% p(10)REPLACE_WITH_DASH_DASH> p2 in the equation of the article
% p(11)REPLACE_WITH_DASH_DASH> p3 in the equation of the article
% p(12)REPLACE_WITH_DASH_DASH> p4 in the equation of the article
% p(13)REPLACE_WITH_DASH_DASH> p15 in the equation of the article
% p(14)REPLACE_WITH_DASH_DASH> p14 in the equation of the article
% p(15)REPLACE_WITH_DASH_DASH> p12 in the equation of the article
% p(16)REPLACE_WITH_DASH_DASH> p13 in the equation of the article
% p(17)REPLACE_WITH_DASH_DASH> p21 in the equation of the article
% p(18)REPLACE_WITH_DASH_DASH> p22 in the equation of the article
% p(19)REPLACE_WITH_DASH_DASH> p23 in the equation of the article
% p(20)REPLACE_WITH_DASH_DASH> p24 in the equation of the article
% p(21)REPLACE_WITH_DASH_DASH> p16 in the equation of the article
% p(22)REPLACE_WITH_DASH_DASH> p17 in the equation of the article
% p(23)REPLACE_WITH_DASH_DASH> p18 in the equation of the article

% The vector p_peak is held fixed
% p_peak(1)REPLACE_WITH_DASH_DASH> p19 in the equation of the article
% p_peak(2)REPLACE_WITH_DASH_DASH> p20 in the equation of the article




%% *IN VITRO CONDITIONS*
%
% In vitro data sources:
%
% * Experiment A: Simulation of glucose and calcium decoupling. Fig. 4 J-C Henquin et al., Diabetes, 2002
% * Experiment B: Hyperglycemic clamp. Fig. 3 J-C Henquin et al., Diabetes, 2006.
% * Experiment C: Stepped hyperglycemic clamp. Fig. 7 J.C. Jonkers et al., Diabetes, 2001.




%% - Experiment A: Glucose and calcium decoupling

load Henquin_2002 % load Henquin 2002 data (four data series)
p=loadpar('Henquin_2002'); % reference parameters

% Simulate secretion
secmod=secsim(p,ca(1),glu(1),p,ca(2),glu(2),p,ca(3),glu(3),p,ca(4),glu(4)); % calculates the model output

% Plot  data S vs model S (Fig. 3A and S2 article)

set(gcf,'position', [300 250 500 400])
for k=1:4
    subplot(2,2,k)
    plot(sec(k).t,sec(k).v,'k',secmod(k).t,secmod(k).v,'r')
    ylabel('S (pg islet^{-1} min^{-1})')
    xlabel('Time (min)')
    legend('Data','Model')
end

%% - Experiment B: Hyperglycemic clamp
clear all %#ok<*CLALL>

load Henquin_2006 % load Henquin 2006 data (four data series)
[p,p_peak]=loadpar('Henquin_2006'); % reference parameters

% Simulate secretion
secmod=secsim(p,ca(1),glu(1),p,ca(2),glu(2),p,ca(3),glu(3));

% Plot data glucose (Fig. 3B article)
clf
set(gcf,'position', [250 250 500 550])
for k=1:3
    subplot(3,1,k)
    plot(glu(k).t, glu(k).v,'k')
    ylabel('G (mM)')
end


% Plot data calcium (Fig. 3B article)
clf
for k=1:3
    subplot(3,1,k)
    plot(ca(k).t, ca(k).v,'k')
    xlabel('Time (min)')
    ylabel('C (nM)')
end


% Plot data secretion vs model secretion (Fig. 3B article)
clf
for k=1:3
    subplot(3,1,k)
    plot(sec(k).t,sec(k).v,'k',secmod(k).t,secmod(k).v,'r')
    ylabel('S (% of content per min)')
    xlabel('Time (min)')
    legend('Data','Model')
end

%%
% Plot data calcium vs model calcium (Fig. 5 article)

% Simulate calcium
pca=[p_peak;p(17:23)]; % calcium parameter
camod=struct('t',{},'v',{});
for k=1:3
    camod(k)=casim(glu(k),pca);
end

clf
for k=1:3
    subplot(3,1,k)
    plot(ca(k).t-0.6,ca(k).v,'k',camod(k).t,camod(k).v,'r') % Time shift of 0.6 min to align calcium data with calcium simulated
    ylabel('C (nM)')
    xlabel('Time (min)')
    legend('Data','Model')
end

%%
% Plot calcium and secretion ca peak vs calcium no ca peak (Figure S9 article)


% Simulate calcium without intial peak
pg2c=p(21:23); % calcium parameter
camod_nopeak=struct('t',{},'v',{});
for k=1:3
    camod_nopeak(k).v=glu2ca(pg2c,glu(k).v);
    camod_nopeak(k).t=glu(k).t;
end


% Simulate secretion with Ca initial peak
secmod_peak=secsim(p,camod(1),glu(1),p,camod(2),glu(2),p,camod(3),glu(3));

% Simulate secretion without Ca initial peak
secmod_nopeak=secsim(p,camod_nopeak(1),glu(1),p,camod_nopeak(2),glu(2),p,camod_nopeak(3),glu(3));


% Plot calcium
clf

for k=1:3
    subplot(3,1,k)
    plot(camod(k).t,camod(k).v,'k',camod_nopeak(k).t,camod_nopeak(k).v,'r')
    ylabel('C (nM)')
    xlabel('Time (min)')
    legend('Model Ca peak','Model no Ca peak')
end

% Plot  secretion
clf


for k=1:3
    subplot(3,1,k)
    plot(secmod_peak(k).t,secmod_peak(k).v,'k',secmod_nopeak(k).t,secmod_nopeak(k).v,'r')
    ylabel('S (% of content per min)')
    xlabel('Time (min)')
    legend('Model Ca peak','Model no Ca peak')
end

%% - Experiment C: Glucose staircase
clear all

load Jonkers_2001 % Data from figure 7 Jonkers et al. 2001
p=loadpar('Jonkers_2001'); % reference parameter

% Simulate secretion
secmod=secsim(p,ca,glu);


% Plot data glucose (Fig. 3C article)
clf

subplot(3,1,1)
plot(glu.t,glu.v,'k')
xlabel('Time(min)')
ylabel('G (mM)')

% Plot data calcium (Fig. 3C article)
subplot(3,1,2)
plot(ca.t,ca.v,'k')
xlabel('Time (min)')
ylabel('C (nM)')

% Plot data secretion vs model secretion (Fig. 3C article)
subplot(3,1,3)
plot(sec.t,sec.v,'k',secmod.t,secmod.v,'r')
ylabel('S (pg/min)')
xlabel('Time (min)')
legend('Data','Model')

%% - Potentiation
clear all

[p,p_peak]=loadpar('Henquin_2006'); % reference parameters

% set glucose
glu.t=0:110;
glu.v=[8.5*ones(1,10) 16.7*ones(1,61) 8.5*ones(1,10) 16.7*ones(1,30)];

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter

camod=casim(glu,pca);

% Simulate secretion
[secmod, irp,r]=secsim(p,camod,glu);

% Plot glucose 

clf
set(gcf,'position', [250 250 500 800])
subplot(5,1,1)
plot(glu.t,glu.v,'k')
xlabel('Time(min)')
ylabel('G (mM)')

% Plot calcium 
subplot(5,1,2)
plot(camod.t,camod.v,'k')
xlabel('Time (min)')
ylabel('C (nM)')

% Plot  secretion 
subplot(5,1,3)
plot(secmod.t,secmod.v,'k')
ylabel('S (% of content per min)')
xlabel('Time (min)')

% Plot Immediately releasable pool
subplot(5,1,4)
plot(irp.t, irp.v,'k') 
xlabel('Time (min)')
ylabel('Q (pmol/m^{2})')
xlabel('Time (min)')


% Plot refilling
subplot(5,1,5)
plot(r(1).t, r(1).v,'k') 
xlabel('Time (min)')
ylabel('r (pmol min^{-1} m^{-2})')
xlabel('Time (min)')




%% *IN VIVO CONDITIONS*
%
% Calcium concentrations in vivo are not available experimentally. As
% described in the paper, the C(G) relationship is implemented in the
% `casim()` function.
%
% In vivo data source:
%
% * Stepped hyperglycemic clamp: Toschi et al., 2002
% * IVGTT: Fig 3 Mari A., Diabetologia, 1998
% * OGTT-like: Fig. 3 Muscelli E. et al, Am. J. Physiol. Endocrinol. Metab., 2006
% * Glucose ramp: Seghieri et al., Am. J. Physiol. Endocrinol. Metab., 2016
% * Hyperglycemic clamp: Mychaliszin et al., Diabetes, 2014 


%% - Stepped hyperglycemic clamp (Panel A) 
%
% Data from Toschi et al., 2002

clear all

% load data
load Toschi_2002_NGT

[p,p_peak]=loadpar('Toschi_2002_NGT'); % reference parameters

BSA=2.1605; % body surface calculated from data

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter

camod=casim(glu,pca);

% Simulate secretion
secmod=secsim(p,camod,glu);

% Plot glucose, calcium, secretion


clf
set(gcf,'position', [250 250 500 550])
subplot(3,1,1)
plot(glu.t,glu.v,'k')
setAxes(-5, 90, 4, '', 0, 20, 5, 'G (mmol/L)') % generate the figure with the proper layout
subplot(3,1,2)
plot(camod.t,camod.v,'k')
setAxes(-5, 90, 4, '', 0, 400, 3, 'C (nmol/L)') % generate the figure with the proper layout
subplot(3,1,3)
plot(sec.t,sec.v/BSA,'k',secmod.t,secmod.v/BSA,'r') % data and model secretion need to be normalized to body surface
setAxes(-5, 90, 4, 'Time (min)', 0, 600, 3, 'S (pmol min^{-1}m^{-2})') % generate the figure with the proper layout


% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg')  

%% - IVGTT (Panel B left) 
%
% Data from Mari, 1998
clear all

% load data
load Mari_1998_NGT

[p,p_peak]=loadpar('Mari_1998_NGT'); % reference parameters

BSA=1.8647; % body surface calculated from data

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter

camod=casim(glu,pca);

% Simulate secretion
secmod=secsim(p,camod,glu);

% Plot glucose, calcium, secretion
clf

subplot(3,1,1)
plot(glu.t,glu.v,'k')
setAxes(-5, 90, 4, '', 0, 30, 4, 'G (mmol/L)') % generate the figure with the proper layout
subplot(3,1,2)
plot(camod.t,camod.v,'k')
setAxes(-5, 90, 4, '', 0, 600, 4, 'C (nmol/L)') % generate the figure with the proper layout
subplot(3,1,3)
plot(sec.t,sec.v,'k',secmod.t,secmod.v/BSA,'r') %  model secretion needs to be normalized to body surface
setAxes(-5, 90, 4, 'Time (min)', 0, 2000, 3, 'S (pmol min^{-1}m^{-2})') % generate the figure with the proper layout


% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg')  


%% - IVGTT T2D (Panel B right) 
%
% Data from Mari, 1998
clear all

% load data
load Mari_1998_T2D

[p,p_peak]=loadpar('Mari_1998_T2D'); % reference parameters

BSA=1.9801; % body surface calculated from data

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter

camod=casim(glu,pca);

% Simulate secretion
secmod=secsim(p,camod,glu);

% Plot glucose, calcium, secretion
clf

subplot(3,1,1)
plot(glu.t,glu.v,'k')
setAxes(-5, 90, 4, '', 0, 30, 4, 'G (mmol/L)') % generate the figure with the proper layout
subplot(3,1,2)
plot(camod.t,camod.v,'k')
setAxes(-5, 90, 4, '', 0, 600, 4, 'C (nmol/L)') % generate the figure with the proper layout
subplot(3,1,3)
plot(sec.t,sec.v,'k',secmod.t,secmod.v/BSA,'r') %  model secretion needs to be normalized to body surface
setAxes(-5, 90, 4, 'Time (min)', 0, 2000, 3, 'S (pmol min^{-1}m^{-2})') % generate the figure with the proper layout


% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg')  

%% - OGTT-like (Panel C left) 
%
% Data from Muscelli et al., 2006
clear all

% load data
load Muscelli_2006_NGT

[p,p_peak]=loadpar('Muscelli_2006_NGT'); % reference parameters

BSA=1.8956; % body surface calculated from data

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter

camod=casim(glu,pca);

% Simulate secretion
secmod=secsim(p,camod,glu);

% Plot glucose, calcium, secretion
clf

subplot(3,1,1)
plot(glu.t,glu.v,'k')
setAxes(-5, 180, 7, '', 5, 15, 3, 'G (mmol/L)') % generate the figure with the proper layout
subplot(3,1,2)
plot(camod.t,camod.v,'k')
setAxes(-5, 180, 7, '', 50, 250, 3, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(3,1,3)
plot(sec.t,sec.v,'k',secmod.t,secmod.v/BSA,'r') %  model secretion needs to be normalized to body surface
setAxes(-5, 180, 7, 'Time (min)', ...
    0, 500, 3, 'S (pmol min^{-1}m^{-2})') % generate the figure with the proper layout


% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg') 

%% - OGTT-like T2D (Panel C right) 
%
% Data from Muscelli et al., 2006
clear all

% load data
load Muscelli_2006_T2D

[p,p_peak]=loadpar('Muscelli_2006_T2D'); % reference parameters

BSA=2.265; % body surface calculated from data

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter

camod=casim(glu,pca);

% Simulate secretion
secmod=secsim(p,camod,glu);

% Plot glucose, calcium, secretion
clf

subplot(3,1,1)
plot(glu.t,glu.v,'k')
setAxes(-5, 180, 7, '', 5, 15, 3, 'G (mmol/L)') % generate the figure with the proper layout
subplot(3,1,2)
plot(camod.t,camod.v,'k')
setAxes(-5, 180, 7, '', 50, 250, 3, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(3,1,3)
plot(sec.t,sec.v,'k',secmod.t,secmod.v/BSA,'r') %  model secretion needs to be normalized to body surface
setAxes(-5, 180, 7, 'Time (min)', ...
    0, 500, 3, 'S (pmol min^{-1}m^{-2})') % generate the figure with the proper layout


% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg') 

%% - Ramp glucose (Panel D left) 
%
% Data from Seghieri et al., 2016
clear all

% load data
load Seghieri_2016_NGT

[p,p_peak]=loadpar('Seghieri_2016_NGT'); % reference parameters

BSA=1.9658; % body surface calculated from data

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter

camod=casim(glu,pca);

% Simulate secretion
secmod=secsim(p,camod,glu);

% Plot glucose, calcium, secretion
clf

subplot(3,1,1)
plot(glu.t,glu.v,'k')
setAxes(-5, 180, 7, '', 0, 30, 4, 'G (mmol/L)') % generate the figure with the proper layout
subplot(3,1,2)
plot(camod.t,camod.v,'k')
setAxes(-5, 180, 7, '', 0, 300, 4, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(3,1,3)
plot(sec.t,sec.v,'k',secmod.t,secmod.v/BSA,'r') %  model secretion needs to be normalized to body surface
setAxes(-5, 180, 7, 'Time (min)', 0, 1500, 4, 'S (pmol min^{-1}m^{-2})') % generate the figure with the proper layout


% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg') 

%% -  Ramp glucose T2D (Panel D right) 
%
% Data from Seghieri et al., 2016
clear all

% load data
load Seghieri_2016_T2D

[p,p_peak]=loadpar('Seghieri_2016_T2D'); % reference parameters

BSA=2.0766; % body surface calculated from data

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter

camod=casim(glu,pca);

% Simulate secretion
secmod=secsim(p,camod,glu);

% Plot glucose, calcium, secretion
clf

subplot(3,1,1)
plot(glu.t,glu.v,'k')
setAxes(-5, 180, 7, '', 0, 30, 4, 'G (mmol/L)') % generate the figure with the proper layout
subplot(3,1,2)
plot(camod.t,camod.v,'k')
setAxes(-5, 180, 7, '', 0, 300, 4, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(3,1,3)
plot(sec.t,sec.v,'k',secmod.t,secmod.v/BSA,'r') %  model secretion needs to be normalized to body surface
setAxes(-5, 180, 7, 'Time (min)', 0, 1500, 4, 'S (pmol min^{-1}m^{-2})') % generate the figure with the proper layout


% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg') 

%% - Glucose hyperglycaemic clamp (Panel E left) 
%
% Data from Mychaliszin et al., 2014

% load data
load Mychaliszin_2014_NGT

[p,p_peak]=loadpar('Mychaliszin_2014_NGT'); % reference parameters

BSA=2.1327; % body surface calculated from data

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter

camod=casim(glu,pca);

% Simulate secretion
secmod=secsim(p,camod,glu);

% Plot glucose, calcium, secretion
clf

subplot(3,1,1)
plot(glu.t,glu.v,'k')
setAxes(-5, 120, 5, '', 0, 15, 4, 'G (mmol/L)') % generate the figure with the proper layout
subplot(3,1,2)
plot(camod.t,camod.v,'k')
setAxes(-5, 120, 5, '', 0, 400, 3, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(3,1,3)
plot(sec.t,sec.v/BSA,'k',secmod.t,secmod.v/BSA,'r') %  data and model secretion need to be normalized to body surface
setAxes(-5, 120, 5, 'Time (min)', 0, 6000, 4, 'S (pmol min^{-1}m^{-2})') % generate the figure with the proper layout


% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg') 

%% - Glucose hyperglycaemic clamp T2D (Panel E right) 
%
% Data from Mychaliszin et al., 2014
clear all

% load data
load Mychaliszin_2014_T2D

[p,p_peak]=loadpar('Mychaliszin_2014_T2D'); % reference parameters

BSA=2.2283; % body surface calculated from data

% Calculate calcium from glucose
pca=[p_peak;p(17:23)]; % calcium parameter

camod=casim(glu,pca);

% Simulate secretion
secmod=secsim(p,camod,glu);

% Plot glucose, calcium, secretion
clf

subplot(3,1,1)
plot(glu.t,glu.v,'k')
setAxes(-5, 120, 5, '', 0, 15, 4, 'G (mmol/L)') % generate the figure with the proper layout
subplot(3,1,2)
plot(camod.t,camod.v,'k')
setAxes(-5, 120, 5, '', 0, 400, 3, 'C (nmol/L)')  % generate the figure with the proper layout
subplot(3,1,3)
plot(sec.t,sec.v/BSA,'k',secmod.t,secmod.v/BSA,'r') %  data and model secretion need to be normalized to body surface
setAxes(-5, 120, 5, 'Time (min)', 0, 6000, 4, 'S (pmol min^{-1}m^{-2})') % generate the figure with the proper layout


% saveas_ifsvg(gcf,'svg_human_all_test/panel_A.svg') 

%% -  Loss of 1st phase secretion with fasting hyperglicemia - glucose clamp
clear all

glu(1).t=[0:1:5 5.02:0.2:6 6:0.5:50];
glu(1).v=[5.27*ones(1,6) 15*ones(1,94)]; %  basal normoglycemia
glu(2).t=[0:1:5 5.02:0.2:6 6:0.5:50];
glu(2).v=[7*ones(1,6) 15*ones(1,94)];  % baal hyperglycemia 

[p,p_peak]=loadpar('Toschi_2002_NGT'); % reference parameters

BSA=2; % body surface

% Calculate calcium
pca=[p_peak;p(17:23)]; % calcium parameter
camod=struct('t',{},'v',{});
for k=1:2
    camod(k)=casim(glu(k),pca);
end

% Simulate secretion
[secmod, irp,r]=secsim(p,camod(1),glu(1),p,camod(2),glu(2));

% Plot - Fig. S4 article

% Plot glucose 
clf
set(gcf,'position', [250 250 500 800])

subplot(5,1,1)
plot(glu(1).t, glu(1).v,'k',glu(1).t, glu(1).v,'r')
xlabel('Time (min)')
ylabel('G (mM)')


% Plot calcium 
subplot(5,1,2)
plot(camod(1).t, camod(1).v,'k',camod(2).t, camod(2).v,'r')
xlabel('Time (min)')
ylabel('C (nM)')


% Plot secretion
subplot(5,1,3)
plot(secmod(1).t, secmod(1).v/BSA,'k',secmod(2).t, secmod(2).v/BSA,'r') % model secretion needs to be normalized for body surface
xlabel('Time (min)')
ylabel('S (pmol min^{-1} m^{-2})')
xlabel('Time (min)')


% Plot Immediately releasable pool
subplot(5,1,4)
plot(irp(1).t, irp(1).v/BSA,'k',irp(2).t, irp(2).v/BSA,'r') % model secretion needs to be normalized for body surface
xlabel('Time (min)')
ylabel('Q (pmol/m^{2})')
xlabel('Time (min)')


% Plot refilling
subplot(5,1,5)
plot(r(1).t, r(1).v/BSA,'k',r(2).t, r(2).v/BSA,'r') % model secretion needs to be normalized for body surface
xlabel('Time (min)')
ylabel('r (pmol min^{-1} m^{-2})')
xlabel('Time (min)')
legend('Basal normoglycemia','Basal hyperglycemia')
    
%% -  Loss of 1st phase secretion with fasting hyperglicemia - OGTT-like
clear all

load Muscelli_2006_NGT % load glucose data
[p,p_peak]=loadpar('Muscelli_2006_NGT');

% glucose input
glu(1).t=glu.t; % normal glucose tolerant subject
glu(1).v=glu.v;
glu(2).t=glu(1).t; % hyperglycemic subject
glu(2).v=glu(1).v+1.5;

BSA=2; % body surface 

% Calculate calcium
pca=[p_peak;p(17:23)]; % calcium parameter
camod=struct('t',{},'v',{});
for k=1:2
    camod(k)=casim(glu(k),pca);
end

% Simulate secretion
[secmod, irp,r]=secsim(p,camod(1),glu(1),p,camod(2),glu(2));


% Plot - Fig. S8 article

% Plot glucose 
clf

subplot(5,1,1)
plot(glu(1).t, glu(1).v,'k',glu(1).t, glu(1).v,'r')
xlabel('Time (min)')
ylabel('G (mM)')


% Plot calcium 
subplot(5,1,2)
plot(camod(1).t, camod(1).v,'k',camod(2).t, camod(2).v,'r')
xlabel('Time (min)')
ylabel('C (nM)')


% Plot secretion
subplot(5,1,3)
plot(secmod(1).t, secmod(1).v/BSA,'k',secmod(2).t, secmod(2).v/BSA,'r') % model secretion needs to be normalized for body surface
xlabel('Time (min)')
ylabel('S (pmol min^{-1} m^{-2})')
xlabel('Time (min)')


% Plot Immediately releasable pool
subplot(5,1,4)
plot(irp(1).t, irp(1).v/BSA,'k',irp(2).t, irp(2).v/BSA,'r') % model secretion needs to be normalized for body surface
xlabel('Time (min)')
ylabel('Q (pmol/m^{2})')
xlabel('Time (min)')


% Plot refilling
subplot(5,1,5)
plot(r(1).t, r(1).v/BSA,'k',r(2).t, r(2).v/BSA,'r') % model secretion needs to be normalized for body surface
xlabel('Time (min)')
ylabel('r (pmol min^{-1} m^{-2})')
xlabel('Time (min)')
legend('Basal normoglycemia','Basal hyperglycemia')


%% - Augmented AIR in insulin resistance with augmented basal secretion
clear all

[p,p_peak]=loadpar('Toschi_2002_NGT'); % reference parameters
p_insres=p;
p_insres(8)=2*p(8); % augmented basal secretion in insulin resistance

% set glucose
glu.t=[0:1:5 5.02:0.2:6 6:0.5:50];
glu.v=[5.27*ones(1,6) 15*ones(1,94)];

BSA=2; % body surface

% Calculate calcium
pca=[p_peak;p(17:23)]; % calcium parameter
camod=casim(glu,pca);

% Simulate secretion
[secmod, irp,r]=secsim(p,camod,glu,p_insres,camod,glu);


% Plot - Fig. S7 article

% Plot glucose 
clf

subplot(5,1,1)
plot(glu.t, glu.v,'k')
xlabel('Time (min)')
ylabel('G (mM)')



% Plot calcium 
subplot(5,1,2)
plot(camod.t, camod.v,'k')
xlabel('Time (min)')
ylabel('C (nM)')


% Plot secretion
subplot(5,1,3)
plot(secmod(1).t, secmod(1).v/BSA,'k',secmod(2).t, secmod(2).v/BSA,'r') % model secretion needs to be normalized for body surface
xlabel('Time (min)')
ylabel('S (pmol min^{-1} m^{-2})')
xlabel('Time (min)')


% Plot Immediately releasable pool
subplot(5,1,4)
plot(irp(1).t, irp(1).v/BSA,'k',irp(2).t, irp(2).v/BSA,'r') % model secretion needs to be normalized for body surface
xlabel('Time (min)')
ylabel('Q (pmol/m^{2})')
xlabel('Time (min)')


% Plot refilling
subplot(5,1,5)
plot(r(1).t, r(1).v/BSA,'k',r(2).t, r(2).v/BSA,'r') % model secretion needs to be normalized for body surface
xlabel('Time (min)')
ylabel('r (pmol min^{-1} m^{-2})')
xlabel('Time (min)')
legend('Insulin sensitivity','Insulin resistance')



%% - Glucose hyperglycaemic clamp calcium peak vs no calcium peak
clear all

[p,p_peak]=loadpar('Toschi_2002_NGT'); % reference parameters

% set glucose
glu.t=[0:1:5 5.02:0.2:6 6:0.5:50];
glu.v=[5.27*ones(1,6) 15*ones(1,94)];

BSA=2; % body surface

% Calculate calcium with inital peak
pca=[p_peak;p(17:23)]; % calcium parameter
camod=struct('t',{},'v',{});
camod(1)=casim(glu,pca);

% Calculate calcium without inital peak
pg2c=p(21:23); % calcium parameter no peak
camod(2).v=glu2ca(pg2c,glu.v);
camod(2).t=glu.t;

% Simulate secretion 
secmod=secsim(p,camod(1),glu,p,camod(2),glu);

% Plot - Fig. S9 article

% Plot glucose 
clf
set(gcf,'position', [250 250 500 550])

subplot(3,1,1)
plot(glu.t, glu.v,'k')
xlabel('Time (min)')
ylabel('G (mM)')


% Plot calcium 
subplot(3,1,2)
plot(camod(1).t, camod(1).v,'k',camod(2).t, camod(2).v,'r')
xlabel('Time (min)')
ylabel('C (nM)')
legend('Ca model with peak','Ca model without peak')


% Plot secretion
subplot(3,1,3)
plot(secmod(1).t, secmod(1).v/BSA,'k',secmod(2).t, secmod(2).v/BSA,'r') % model secretion needs to be normalized for body surface
xlabel('Time (min)')
ylabel('S (pmol min^{-1} m^{-2})')
xlabel('Time (min)')
legend('Ca model with peak','Ca model without peak')


%% - Dose response NGT vs T2D - parameters of glucose ramp
clear all

[p_ramp,p_peak]=loadpar('Seghieri_2016_NGT'); % reference parameters NGT
p_ramp_d=loadpar('Seghieri_2016_T2D'); % reference parameters T2D

BSA=2; % body surface

glu=0:30;        
ca=50:300; 
gluref=20;
caref=200;

% Plot - Figure 7 of the article
clf
set(gcf,'position', [250 250 500 400]) 
       
subplot(2,2,1)
plot(ca,fCa(p_ramp,ca),'k',ca,fCa(p_ramp_d,ca),'r')
xlabel('C (nM)')
ylabel('f_k (1/min)')
legend('NGT','T2D')

subplot(2,2,2)
plot(ca,fCaGlu(p_ramp,ca,gluref)/BSA,'k',ca,fCaGlu(p_ramp_d,ca,gluref)/BSA,'r') % /BSA to normalize for body surface
xlabel('C (nM)')
ylabel('f_r (pmol min^{-1}m^{-2})') 
xlim([0 300])
title('G=20 mM')
legend('NGT','T2D')

subplot(2,2,3)
plot(glu,fCaGlu(p_ramp,caref,glu)/BSA,'k',glu,fCaGlu(p_ramp_d,caref,glu)/BSA,'r') % /BSA to normalize for body surface
xlabel('G (mM)')
ylabel('f_r (pmol min^{-1}m^{-2})') 
xlim([0 30])
title('C=200 nM')
legend('NGT','T2D')



##### SOURCE END #####
--></body></html>